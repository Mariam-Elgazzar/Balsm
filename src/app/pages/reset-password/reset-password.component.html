<div class="reset-password-container">
  <div class="reset-password-form-container">
    <!-- Success Message -->
    <div class="success-message" *ngIf="submitted() && !errorMessage()">
      <span class="material-icons">check_circle</span>
      <p>
        تم إعادة تعيين كلمة المرور بنجاح! سيتم توجيهك إلى صفحة تسجيل الدخول...
      </p>
    </div>

    <!-- Form -->
    <div class="form-container" *ngIf="!submitted() || errorMessage()">
      <h1 class="reset-password-title">إعادة تعيين كلمة المرور</h1>
      <p class="reset-password-subtitle">
        أدخل بريدك الإلكتروني وكلمة المرور الجديدة لإعادة تعيين حسابك.
      </p>

      <form
        [formGroup]="resetPasswordForm"
        (ngSubmit)="onSubmit()"
        class="reset-password-form"
      >
        <!-- Error Message -->
        <div class="error-message" *ngIf="errorMessage()">
          {{ errorMessage() }}
        </div>

        <!-- Email -->
        <div class="form-group">
          <label for="email">البريد الإلكتروني</label>
          <input
            type="email"
            id="email"
            formControlName="email"
            placeholder="أدخل البريد الإلكتروني"
            [class.is-invalid]="
              emailControl.invalid && (emailControl.touched || submitted())
            "
          />
          <div
            class="error-message"
            *ngIf="
              emailControl.invalid && (emailControl.touched || submitted())
            "
          >
            <span *ngIf="emailControl.errors?.['required']"
              >البريد الإلكتروني مطلوب</span
            >
            <span *ngIf="emailControl.errors?.['email']"
              >يرجى إدخال بريد إلكتروني صالح</span
            >
          </div>
        </div>

        <!-- Password -->
        <div class="form-group">
          <label for="password">كلمة المرور الجديدة</label>
          <div class="password-input-container">
            <input
              [type]="showPassword() ? 'text' : 'password'"
              id="password"
              formControlName="password"
              placeholder="أدخل كلمة المرور الجديدة"
              [class.is-invalid]="
                passwordControl.invalid &&
                (passwordControl.touched || submitted())
              "
            />
            <button
              type="button"
              class="toggle-password"
              (click)="togglePasswordVisibility()"
            >
              <span class="material-icons">{{
                showPassword() ? "visibility_off" : "visibility"
              }}</span>
            </button>
          </div>
          <div
            class="error-message"
            *ngIf="
              passwordControl.invalid &&
              (passwordControl.touched || submitted())
            "
          >
            <span *ngIf="passwordControl.errors?.['required']"
              >كلمة المرور مطلوبة</span
            >
            <span *ngIf="passwordControl.errors?.['minlength']"
              >يجب أن تتكون كلمة المرور من 8 أحرف على الأقل</span
            >
            <span *ngIf="passwordControl.errors?.['pattern']"
              >يجب أن تحتوي كلمة المرور على حرف، رقم، ورمز خاص</span
            >
          </div>
        </div>

        <!-- Confirm Password -->
        <div class="form-group">
          <label for="confirmPassword">تأكيد كلمة المرور</label>
          <div class="password-input-container">
            <input
              [type]="showConfirmPassword() ? 'text' : 'password'"
              id="confirmPassword"
              formControlName="confirmPassword"
              placeholder="أكد كلمة المرور"
              [class.is-invalid]="
                resetPasswordForm.hasError('mismatch') &&
                (confirmPasswordControl.touched || submitted())
              "
            />
            <button
              type="button"
              class="toggle-password"
              (click)="toggleConfirmPasswordVisibility()"
            >
              <span class="material-icons">{{
                showConfirmPassword() ? "visibility_off" : "visibility"
              }}</span>
            </button>
          </div>
          <div
            class="error-message"
            *ngIf="
              resetPasswordForm.hasError('mismatch') &&
              (confirmPasswordControl.touched || submitted())
            "
          >
            كلمات المرور غير متطابقة
          </div>
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="reset-password-button"
          [disabled]="resetPasswordForm.invalid || isLoading()"
        >
          {{ isLoading() ? "جارٍ الإرسال..." : "إعادة تعيين كلمة المرور" }}
        </button>
      </form>

      <div class="reset-password-footer">
        <p>لديك حساب؟ <a routerLink="/auth/login">تسجيل الدخول</a></p>
      </div>
    </div>
  </div>
</div>
