<div class="reset-password-container">
  <div class="reset-password-form-container">
    <h1 class="reset-password-title">إعادة تعيين كلمة المرور</h1>

    <!-- Loading state -->
    <div *ngIf="isTokenValidating()" class="loading-container">
      <div class="spinner"></div>
      <p>جاري التحقق من رمز إعادة التعيين...</p>
    </div>

    <!-- Invalid token error -->
    <div
      *ngIf="!isTokenValidating() && !isTokenValid()"
      class="error-container"
    >
      <div class="error-icon">
        <span class="material-icons">error</span>
      </div>
      <h2 class="error-title">خطأ في إعادة التعيين</h2>
      <p class="error-message">{{ errorMessage() }}</p>
      <button class="back-button" (click)="backToLogin()">
        العودة إلى تسجيل الدخول
      </button>
    </div>

    <!-- Reset password form -->
    <div *ngIf="!isTokenValidating() && isTokenValid() && !submitted()">
      <p class="reset-password-subtitle">أدخل كلمة المرور الجديدة الخاصة بك.</p>

      <form
        [formGroup]="resetPasswordForm"
        (ngSubmit)="onSubmit()"
        class="reset-password-form"
      >
        <div class="form-group">
          <label for="password">كلمة المرور الجديدة</label>
          <div class="password-input-container">
            <input
              [type]="showPassword() ? 'text' : 'password'"
              id="password"
              formControlName="password"
              placeholder="أدخل كلمة المرور الجديدة"
              [class.is-invalid]="
                passwordControl.invalid && passwordControl.touched
              "
            />
            <button
              type="button"
              class="toggle-password"
              (click)="togglePasswordVisibility()"
            >
              <span class="material-icons">{{
                showPassword() ? "visibility_off" : "visibility"
              }}</span>
            </button>
          </div>
          <div
            class="error-message"
            *ngIf="passwordControl.invalid && passwordControl.touched"
          >
            <span *ngIf="passwordControl.errors?.['required']"
              >كلمة المرور مطلوبة</span
            >
            <span *ngIf="passwordControl.errors?.['minlength']"
              >يجب أن تتكون كلمة المرور من 8 أحرف على الأقل</span
            >
          </div>
        </div>

        <div class="form-group">
          <label for="confirmPassword">تأكيد كلمة المرور</label>
          <div class="password-input-container">
            <input
              [type]="showConfirmPassword() ? 'text' : 'password'"
              id="confirmPassword"
              formControlName="confirmPassword"
              placeholder="أعد إدخال كلمة المرور الجديدة"
              [class.is-invalid]="
                (confirmPasswordControl.invalid &&
                  confirmPasswordControl.touched) ||
                (resetPasswordForm.hasError('mismatch') &&
                  confirmPasswordControl.touched)
              "
            />
            <button
              type="button"
              class="toggle-password"
              (click)="toggleConfirmPasswordVisibility()"
            >
              <span class="material-icons">{{
                showConfirmPassword() ? "visibility_off" : "visibility"
              }}</span>
            </button>
          </div>
          <div
            class="error-message"
            *ngIf="
              (confirmPasswordControl.invalid &&
                confirmPasswordControl.touched) ||
              (resetPasswordForm.hasError('mismatch') &&
                confirmPasswordControl.touched)
            "
          >
            <span *ngIf="confirmPasswordControl.errors?.['required']"
              >تأكيد كلمة المرور مطلوب</span
            >
            <span *ngIf="resetPasswordForm.hasError('mismatch')"
              >كلمات المرور غير متطابقة</span
            >
          </div>
        </div>

        <div class="error-message" *ngIf="errorMessage()">
          {{ errorMessage() }}
        </div>

        <button
          type="submit"
          class="submit-button"
          [disabled]="resetPasswordForm.invalid || isLoading()"
        >
          {{
            isLoading() ? "جاري إعادة التعيين..." : "إعادة تعيين كلمة المرور"
          }}
        </button>

        <button type="button" class="back-button" (click)="backToLogin()">
          العودة إلى تسجيل الدخول
        </button>
      </form>
    </div>

    <!-- Success message -->
    <div *ngIf="submitted() && successMessage()" class="success-container">
      <div class="success-icon">
        <span class="material-icons">check_circle</span>
      </div>
      <h2 class="success-title">تم إعادة التعيين بنجاح</h2>
      <p class="success-message">{{ successMessage() }}</p>
      <button class="login-button" (click)="backToLogin()">
        الذهاب إلى تسجيل الدخول
      </button>
    </div>
  </div>
</div>
